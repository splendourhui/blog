<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Splendour's blog" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Splendour's blog">
<meta property="og:url" content="http://splendourhui.com/index.html">
<meta property="og:site_name" content="Splendour's blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Splendour's blog">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'always',
    motion: true
  };
</script>

  <title> Splendour's blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?12423411d7b24eae6e82e3173f32ab00";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Splendour's blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">不积跬步，无以至千里</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">

    

    
    
      
      
        
        
        
      

      
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/17/编写自己项目的-Redux-action-generator/" itemprop="url">
                  编写自己项目的 Redux action generator
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-08-17T19:47:08+08:00" content="2016-08-17">
              2016-08-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/react-redux-前端/" itemprop="url" rel="index">
                    <span itemprop="name">react redux 前端</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h3 id="u80CC_u666F"><a href="#u80CC_u666F" class="headerlink" title="背景"></a>背景</h3><p>使用 <code>React</code> ＋ <code>Redux</code> 也有一段时间了，从第一次尝试使用之后就开始按一种方式写代码，思路很清晰，但就是有一个问题，感觉每写一个 action 都是在 <code>copy</code> ＋ <code>paste</code>，然后修改其中的部分内容，最近想优化代码所以尝试着编写一个 <code>generator</code> 来生成这些 <code>actions</code>，让代码更加优雅。</p>
<h3 id="u539F_u6709_u7684_u5199_u6CD5"><a href="#u539F_u6709_u7684_u5199_u6CD5" class="headerlink" title="原有的写法"></a>原有的写法</h3><p>这是一个 action 的部分代码<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> USER_LIST_LOAD = <span class="string">'USER_LIST_LOAD'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> USER_LIST_SUCCESS = <span class="string">'USER_LIST_SUCCESS'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> USER_LIST_FAIL = <span class="string">'USER_LIST_FAIL'</span>;</span><br><span class="line"></span><br><span class="line">exports.loadUserList = (tenantId, sucCallback, errCallback) =&gt;</span><br><span class="line">  (dispatch, getState) =&gt;</span><br><span class="line">  dispatch(&#123;</span><br><span class="line">    [CALL_API]: &#123;</span><br><span class="line">      types: [</span><br><span class="line">        USER_LIST_LOAD,</span><br><span class="line">        USER_LIST_SUCCESS,</span><br><span class="line">        USER_LIST_FAIL</span><br><span class="line">      ],</span><br><span class="line">      endpoint: <span class="string">`apis/<span class="subst">$&#123;tenantId&#125;</span>/user`</span>,</span><br><span class="line">      schema: Schemas.NORMAL_RESP,</span><br><span class="line">      method: <span class="string">'GET'</span>,</span><br><span class="line">      errMsg: <span class="string">'获取数据失败，请刷新重试'</span>,</span><br><span class="line">      sucCallback,</span><br><span class="line">      errCallback</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> USER_LIST_SELECT = <span class="string">'USER_LIST_SELECT'</span>;</span><br><span class="line">exports.userListSelect = keys =&gt; (&#123;</span><br><span class="line">  type: USER_LIST_SELECT,</span><br><span class="line">  keys</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h3 id="u601D_u8DEF"><a href="#u601D_u8DEF" class="headerlink" title="思路"></a>思路</h3><ul>
<li>每一个 <code>action</code> 无非就是 export 出在全局唯一的常量作为 action 的标识，并且提供可以调用的方法来 dispatch 这样的常量。这里的 action 分为两类，ajax 请求类和非 ajax 请求类，ajax 请求类会 export 3 个常量，分别代表 请求中，请求成功以及请求失败 3 个状态。</li>
<li>传进来的参数，应该要统一成一个（ajax 请求的数据都放在第一个参数里，第二个和第三个固定为成功回调和失败回调）。</li>
<li>为了保证 action 的唯一性，我们需要传入一个参数作为前缀，一般用页面名作为前缀（这里是 USER）。</li>
<li>为了用配置的方式写 actions，考虑把 actions 用 json 数组的方式传进来，这样可以用到 map 函数来遍历并且生成每一个 action。<br>－ 最后要将所有的 action 组装成一个变量 export 出去，再对原有的 import 方法进行修改就可以了。</li>
</ul>
<h3 id="generator__u4EE3_u7801"><a href="#generator__u4EE3_u7801" class="headerlink" title="generator 代码"></a>generator 代码</h3><p>首先，根据是否 ajax 请求，生成对应的 action<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> actionList = (actionPrefix, actions) =&gt;</span><br><span class="line">  map(action =&gt;</span><br><span class="line">    action.isAjax ? (&#123;</span><br><span class="line">      [<span class="string">`<span class="subst">$&#123;actionPrefix&#125;</span>_<span class="subst">$&#123;action.name.toUpperCase()&#125;</span>_LOAD`</span>]:</span><br><span class="line">        <span class="string">`<span class="subst">$&#123;actionPrefix&#125;</span>_<span class="subst">$&#123;action.name.toUpperCase()&#125;</span>_LOAD`</span>,</span><br><span class="line">      [<span class="string">`<span class="subst">$&#123;actionPrefix&#125;</span>_<span class="subst">$&#123;action.name.toUpperCase()&#125;</span>_SUCCESS`</span>]:</span><br><span class="line">        <span class="string">`<span class="subst">$&#123;actionPrefix&#125;</span>_<span class="subst">$&#123;action.name.toUpperCase()&#125;</span>_SUCCESS`</span>,</span><br><span class="line">      [<span class="string">`<span class="subst">$&#123;actionPrefix&#125;</span>_<span class="subst">$&#123;action.name.toUpperCase()&#125;</span>_FAIL`</span>]:</span><br><span class="line">        <span class="string">`<span class="subst">$&#123;actionPrefix&#125;</span>_<span class="subst">$&#123;action.name.toUpperCase()&#125;</span>_FAIL`</span>,</span><br><span class="line">      [action.name]: (data, sucCallback, errCallback) =&gt;</span><br><span class="line">        (dispatch, getState) =&gt;</span><br><span class="line">          dispatch(&#123;</span><br><span class="line">            [CALL_API]: &#123;</span><br><span class="line">              types: [</span><br><span class="line">                <span class="string">`<span class="subst">$&#123;actionPrefix&#125;</span>_<span class="subst">$&#123;action.name.toUpperCase()&#125;</span>_LOAD`</span>,</span><br><span class="line">                <span class="string">`<span class="subst">$&#123;actionPrefix&#125;</span>_<span class="subst">$&#123;action.name.toUpperCase()&#125;</span>_SUCCESS`</span>,</span><br><span class="line">                <span class="string">`<span class="subst">$&#123;actionPrefix&#125;</span>_<span class="subst">$&#123;action.name.toUpperCase()&#125;</span>_FAIL`</span></span><br><span class="line">              ],</span><br><span class="line">              endpoint: action.path,</span><br><span class="line">              schema: action.schema || Schemas.NORMAL_RESP,</span><br><span class="line">              method: action.method,</span><br><span class="line">              errMsg: action.errMsg || <span class="string">'获取数据失败，请刷新重试'</span>,</span><br><span class="line">              data,</span><br><span class="line">              sucCallback,</span><br><span class="line">              errCallback</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">    &#125;) : (&#123;</span><br><span class="line">      [<span class="string">`<span class="subst">$&#123;actionPrefix&#125;</span>_<span class="subst">$&#123;action.name&#125;</span>`</span>]:</span><br><span class="line">        <span class="string">`<span class="subst">$&#123;actionPrefix&#125;</span>_<span class="subst">$&#123;action.name&#125;</span>`</span>,</span><br><span class="line">      [action.name]: data =&gt; (&#123;</span><br><span class="line">        type: <span class="string">`<span class="subst">$&#123;actionPrefix&#125;</span>_<span class="subst">$&#123;action.name&#125;</span>`</span>,</span><br><span class="line">        data</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  )(actions);</span><br></pre></td></tr></table></figure></p>
<ul>
<li>传进来的参数有两个，一个 <code>actionPrefix</code>，一个包含每个 action 信息的数组</li>
<li>对每个 action 来说，<code>isAjax</code> 用来区分是否 ajax 请求; <code>name</code> 是 action 的名字，需要是唯一的; <code>path</code> 和 <code>method</code> 分别代表 ajax 请求的地址和方法（get、post 等）</li>
<li>这里的 <code>map</code> 函数来自于 <code>ramda</code> 库</li>
</ul>
<p>然后，将上面生成的 action 数组合并起来并 export 出去<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (actionPrefix, actions) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> result = &#123;&#125;;</span><br><span class="line">  forEach(action =&gt;</span><br><span class="line">    <span class="built_in">Object</span>.assign(result, action)</span><br><span class="line">  )(actionList(actionPrefix, actions));</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>这里定义了该文件 export 一个函数，接收两个参数</li>
<li>这个函数能够先通过传进来的 actions 生成一系列方法和变量，然后组装起来</li>
<li>这里的 <code>forEach</code> 函数来自于 <code>ramda</code> 库</li>
</ul>
<p>最后，真正的 action 文件只需这样 <code>配置</code> 就能实现原有代码的功能<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> generator <span class="keyword">from</span> <span class="string">'./generator'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> generator(<span class="string">'USER'</span>, [</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'list'</span>,</span><br><span class="line">    isAjax: <span class="literal">true</span>,</span><br><span class="line">    path: <span class="string">'apis/user'</span>,</span><br><span class="line">    method: <span class="string">'GET'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'listSelect'</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure></p>
<h3 id="u65B0_u7684_u95EE_u9898"><a href="#u65B0_u7684_u95EE_u9898" class="headerlink" title="新的问题"></a>新的问题</h3><p>如果 <code>action</code> 的 <code>path</code> 里需要通过部分参数来组装时，就需要再优化 <code>generator</code> 了<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getPath = (path, data) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> replaceStrings = path.match(<span class="regexp">/\$\&#123;\w*\&#125;/g</span>);</span><br><span class="line">  <span class="keyword">if</span> (!replaceStrings) <span class="keyword">return</span> path;</span><br><span class="line">  <span class="keyword">let</span> result = path;</span><br><span class="line">  forEach(replaceString =&gt;</span><br><span class="line">    result = result.replace(replaceString,</span><br><span class="line">      data[replaceString.substring(<span class="number">2</span>, replaceString.length - <span class="number">1</span>)])</span><br><span class="line">  )(replaceStrings);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>先定义这样一个方法，然后再将原有函数的 <code>endpoint</code> 修改一下<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">endpoint: getPath(action.path, data),</span><br></pre></td></tr></table></figure></p>
<ul>
<li>这个函数是利用正则，将 <code>path</code> 中符合 <code>${param}</code> 格式的参数用 <code>data</code> 里面对应的 <code>key</code> 的值替换掉，这样就实现了原有的 <code>apis/${tenantId}/user</code> ES6 模板字符串的写法</li>
<li>要保证调用 <code>action</code> 时候的第一个参数，即 <code>data</code>，含有这些需要转换的参数</li>
</ul>
<p>最终实现这样的 action，只需要这样配置<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  name: <span class="string">'list'</span>,</span><br><span class="line">  isAjax: <span class="literal">true</span>,</span><br><span class="line">  path: <span class="string">'apis/$&#123;tenantId&#125;/user'</span>,</span><br><span class="line">  method: <span class="string">'GET'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>调用时候的示例<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> userActions <span class="keyword">from</span> <span class="string">'../../actions/user'</span>;</span><br><span class="line">userActions.list(&#123;</span><br><span class="line">  tenantId: <span class="string">'11223344'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h3 id="u603B_u7ED3"><a href="#u603B_u7ED3" class="headerlink" title="总结"></a>总结</h3><ul>
<li>经过了这样的改造，代码真的优雅了不少，真正实现了用配置的方式来编写业务，很有成就感。对于这样的项目来讲，只要定好规范，新人很快上手写 <code>action</code> 不是梦。</li>
<li>平时写的代码多了，就要多注意这些一直在 <code>copy</code> 和 <code>paste</code> 的代码，看看是否能够抽取出公共的部分来让代码更加优雅，这才是编程的艺术。</li>
<li>写一个 <code>generator</code> 没那么容易，需要考虑各种情况，还要结合实际权衡，让其能更加通用，具备较强可复用性。另外，反复地斟酌和优化代码是必不可少的过程。</li>
</ul>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/01/React-优化实践/" itemprop="url">
                  React 优化实践
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-08-01T20:07:54+08:00" content="2016-08-01">
              2016-08-01
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JavaScript/" itemprop="url" rel="index">
                    <span itemprop="name">JavaScript</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JavaScript/React/" itemprop="url" rel="index">
                    <span itemprop="name">React</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="u80CC_u666F"><a href="#u80CC_u666F" class="headerlink" title="背景"></a>背景</h2><p>最近在用 React ＋ Redux ＋ WEUI 做一个企业号上的企业系统移动端版本，发现在性能较差的手机上还是有蛮大的卡顿，故开始查找资料想办法进行优化。</p>
<h2 id="why-did-you-update"><a href="#why-did-you-update" class="headerlink" title="why-did-you-update"></a>why-did-you-update</h2><p>无意中看到某大神 Star 了这个项目，一开始还没有特别注意，后来在某博文上又看到该工具的推荐。该工具可以在你的组件每次 <code>reRender</code> 的时候，对比该组件的 <code>props</code>，如果没有变化，会告诉你这是不必要的 <code>reRender</code>。<a href="https://github.com/garbles/why-did-you-update" target="_blank" rel="external">点此进入项目</a><br>工具的使用也特别简单，只需要在前端主文件中加入一句话，装饰一下 React。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">const</span> &#123;whyDidYouUpdate&#125; = <span class="built_in">require</span>(<span class="string">'why-did-you-update'</span>);</span><br><span class="line">whyDidYouUpdate(React);</span><br></pre></td></tr></table></figure>
<p>重新打开页面，发现加载了很久，这是由于 <code>why-did-you-update</code> 在浏览器上打印了很多的信息。不看不知道一看吓一跳，原来在我渲染页面的时候做了这么多无谓的 <code>reRender</code> 操作，真是浪费性能！</p>
<h2 id="ShouldComponentUpdate__u4F18_u5316"><a href="#ShouldComponentUpdate__u4F18_u5316" class="headerlink" title="ShouldComponentUpdate 优化"></a>ShouldComponentUpdate 优化</h2><p>那么多的 <code>reRender</code>，要怎么避免呢？<br>对于无状态组件来说，只需要重新实现该组件的 <code>ShouldComponentUpdate</code> 方法即可。<br><code>ShouldComponentUpdate</code> 默认返回的是 <code>true</code>，即默认当有新的 <code>props</code> 传入时，就执行 <code>reRender</code> 操作。我们要做的就是对比前一个 <code>props</code> 和新传入的 <code>props</code>，来决定是否返回 <code>true</code> 让组件更新。这里分几种情况：</p>
<p>－ 简单的字符串或者数字，直接使用 <code>JavaScript</code> 的 <code>＝＝＝</code> 对比即可<br>－ 对象或者数组，推荐使用 <code>lodash</code> 的 <code>isEqual</code> 函数，可以解决大多数情况下的比较<br>－ 复杂的深层的对象或数组，采用 <code>Immutable.js</code> 去进行比较<br>－ 特殊的，比如某些组件，如果组件的某个 <code>key</code> 不变（例如 id）就不进行更新，那我可以直接对比<code>props</code> 中我想要对比的这个属性即可</p>
<p>以上几种情况的前提，是在 <code>Redux</code> 中传递 <code>state</code> 的时候，对于对象或数组，使用 <code>Object.assign</code> 或者 <code>Immutable.js</code> 来传入一个新的引用，避免因为值不同但是引用地址相同，导致的错误比对。</p>
<h2 id="key"><a href="#key" class="headerlink" title="key"></a>key</h2><p>如果你在 <code>React</code> 中使用了循环去渲染一系列组件（例如列表），<code>React</code> 会提醒你对每一个组件设置一个唯一的 <code>key</code>。<code>React</code> 会根据这个 <code>key</code> 来判断组件的唯一性，如果两个 <code>key</code> 相同，则会只渲染一个组件。<br>其实这个 <code>key</code> 还有另外一个用途，就是判断组件是否需要 <code>reRender</code>。<code>React</code> 会根据这个 <code>key</code> 值来生成该组件的唯一标识，如果下次渲染的时候 <code>key</code> 值不变（即使位置变了），则会复用该组件，只有产生了新的 <code>key</code> 值，才会渲染新的组件。所以，我们也可以利用这个 <code>key</code> 值来避免组件的不必要删除和创建，复用组件以达到性能优化的目的。</p>
<h2 id="u7ED3_u8BED"><a href="#u7ED3_u8BED" class="headerlink" title="结语"></a>结语</h2><p>基本上进行了以上的优化，页面打开速度有了一定的提升，关键是能清楚地知道页面没有进行不必要的 <code>reRender</code>，在性能优化的路上前进了一步。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/14/记一次-react-页面白屏的排查过程/" itemprop="url">
                  记一次 react 页面白屏的排查过程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-07-14T07:45:01+08:00" content="2016-07-14">
              2016-07-14
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/react-移动web-前端/" itemprop="url" rel="index">
                    <span itemprop="name">react 移动web 前端</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h3 id="u80CC_u666F"><a href="#u80CC_u666F" class="headerlink" title="背景"></a>背景</h3><p>近日，在 <code>微信web开发者工具</code> 开发完成页面后，在个人手机上测试通过并移交产品经理测试，发现其手机打开页面后白屏，手机型号同样是 iPhone6，拿了其他小伙伴的安卓手机发现也打不开，无论是在微信浏览器还是在 Safari 或者 安卓原生浏览器均是这样的现象。重新编译、清除缓存都无法解决这个问题。</p>
<h3 id="u89E3_u51B3_u8FC7_u7A0B"><a href="#u89E3_u51B3_u8FC7_u7A0B" class="headerlink" title="解决过程"></a>解决过程</h3><ul>
<li>一般情况下，前端无法渲染是由于 JavaScript 报错产生的，所以最好是看看控制台打印。</li>
<li>上网搜索资料，发现微信团队做了一个让我兴奋的东西：vConsole<ul>
<li>GitHub 地址：<a href="https://github.com/WechatFE/vConsole" target="_blank" rel="external">https://github.com/WechatFE/vConsole</a></li>
<li>该工具使用很简单，只需要引入一个 JavaScript 文件，即可在页面右下角生成一个按钮，点击可以查看控制台，以及手机系统、手机浏览器的一些信息，真是个神器！</li>
</ul>
</li>
<li><p>引入了 vConsole，查看控制台，果然有一个错误抛出</p>
<blockquote>
<p>reference error can’t find variable symbol</p>
</blockquote>
<p>从字面理解，是指浏览器无法识别 symbol 这个变量。</p>
</li>
<li>继续谷歌，发现 GitHub 上有一些 issue 也是报了类似的问题，一篇一篇地读下来，找到了一个关键词，叫 <code>babel-polyifll</code></li>
<li><p>搜索这个关键词，找到了阮一峰的这篇博文 <a href="http://www.ruanyifeng.com/blog/2016/01/babel.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2016/01/babel.html</a></p>
<blockquote>
<p>Babel默认只转换新的JavaScript句法（syntax），而不转换新的API，比如Iterator、Generator、Set、Maps、Proxy、Reflect、Symbol、Promise等全局对象，以及一些定义在全局对象上的方法（比如<code>Object.assign</code>）都不会转码。<br>举例来说，ES6在<code>Array</code>对象上新增了<code>Array.from</code>方法。Babel就不会转码这个方法。如果想让这个方法运行，必须使用<code>babel-polyfill</code>，为当前环境提供一个垫片。</p>
</blockquote>
</li>
<li><p>这下一切都清楚了，浏览器不支持一些新的对象，所以需要引入别的模块才能识别，具体做法很简单：<br>安装</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="operator"><span class="keyword">install</span> <span class="comment">--save babel-polyfill</span></span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>在脚本中，引入该模块<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'babel-polyfill'</span>;</span><br></pre></td></tr></table></figure></p>
<p>编译、测试、问题解决！</p>
<h3 id="u603B_u7ED3"><a href="#u603B_u7ED3" class="headerlink" title="总结"></a>总结</h3><ul>
<li>移动 web 开发的兼容性问题很多，遇到了要多积累经验。</li>
<li>解决问题的思路可以多样化，比如之前一直没想到要在移动端查看控制台，这次解决问题的经历让我学会了一个神器的使用。</li>
<li>谷歌错误信息后，要多打开几个页面，读一读别人的问题以及解决方法，看看能否从中寻找出一些端倪。</li>
<li>学会从一大堆页面和信息中寻找出关键词很重要，一旦找对了，问题很快引刃而解。</li>
</ul>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/20/JavaScript-函数式编程/" itemprop="url">
                  JavaScript 函数式编程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-03-20T14:01:05+08:00" content="2016-03-20">
              2016-03-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JavaScript/" itemprop="url" rel="index">
                    <span itemprop="name">JavaScript</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <blockquote>
<p>在 ES6 的支持下（特别是箭头函数），JavaScript 函数式编程的实践性得到了很大的提升。再加上 Babel 等神器，目前已经可以自己构建函数式编程的一些小套路了。</p>
</blockquote>
<h2 id="u51FD_u6570_u5F0F_u7F16_u7A0B"><a href="#u51FD_u6570_u5F0F_u7F16_u7A0B" class="headerlink" title="函数式编程"></a>函数式编程</h2><p>彻底的函数式编程包括以下特点：</p>
<ul>
<li>禁用 var/let，所有东西都用 const 定义，无变量，强制 immutable</li>
<li>禁用 if/else，允许使用条件表达式 <code>condition ? a : b</code></li>
<li>禁用 for/while/do-while</li>
<li>禁用 prototype 和 this 来解除面向对象编程范式</li>
<li>禁用 function 和 return 关键字，仅试用 lambda 表达式来编程</li>
<li>禁用多参数函数，只允许使用单个参数，相当于强行 curry 化</li>
</ul>
<p>在实践过程中，有时候还是不要强行遵照上面的特点，要灵活应变，写出又有逼格又实用的代码，才是真正追求的。</p>
<h2 id="u7D2F_u52A0_u5668"><a href="#u7D2F_u52A0_u5668" class="headerlink" title="累加器"></a>累加器</h2><p>累加器在编程过程中是很常见的，一般情况下，我们会借助一个临时变量还有循环来进行累加<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 最基本的求和累加器</span></span><br><span class="line"><span class="keyword">let</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> value <span class="keyword">of</span> array) &#123;</span><br><span class="line">  sum += value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>很明显的，上述代码是过程式编程的典型。我们可以用上更高端的 <code>reduce</code> 函数<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">array.reduce((previous, current) =&gt; &#123;</span><br><span class="line">  previous + current;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>逼格瞬间高了很多。如果我们需要给一个初始值，则有<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> initValue = <span class="number">10</span>;</span><br><span class="line">array.reduce((previous, current) =&gt; &#123;</span><br><span class="line">  previous + current;</span><br><span class="line">&#125;, initValue);</span><br></pre></td></tr></table></figure></p>
<h3 id="u5012_u5E8F_u904D_u5386"><a href="#u5012_u5E8F_u904D_u5386" class="headerlink" title="倒序遍历"></a>倒序遍历</h3><p><code>reduce</code> 函数已经让我们可以使用一个函数实现累加器的功能了，那么我们能否将多参数转化为单参数呢？且看下面定义的函数<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> foldr = f =&gt; accumulator =&gt; ([x, ...xs]) =&gt;</span><br><span class="line">  x === <span class="literal">undefined</span> ? accumulator : f(x)(foldr(f)(accumulator)(xs));</span><br></pre></td></tr></table></figure></p>
<p>该函数接受三个参数</p>
<ul>
<li>f：对数组中的每一项和累加器的操作，该参数是一个 <code>函数</code> (函数式编程的特点之一)</li>
<li>accumulator：累加器</li>
<li>[x, …xs]：要操作的数组</li>
</ul>
<p>函数采用递归的方式，算到最后是这样的形式（以数组 [1, 2] 为例）<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f(<span class="number">1</span>)(f(<span class="number">2</span>)(accumulator))</span><br></pre></td></tr></table></figure></p>
<p>不难看出，最终是将数组倒序遍历，计算出 f(x)(accumulator) 的值, 并将结果作为新的 accumulator 传递回去，直到遍历完毕。</p>
<blockquote>
<p>因为是将数组倒序遍历，所以我们将函数起名叫 <code>foldr</code></p>
</blockquote>
<h3 id="sum__u51FD_u6570"><a href="#sum__u51FD_u6570" class="headerlink" title="sum 函数"></a>sum 函数</h3><p>不妨来尝试使用一下这个函数。还是以求和为例，则有<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> f = x =&gt; accumulator =&gt; x + accumulator; <span class="comment">// 箭头函数默认返回</span></span><br><span class="line"><span class="keyword">let</span> initValue = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="keyword">let</span> sumValue = foldr(f)(initValue)(array); <span class="comment">// 20</span></span><br></pre></td></tr></table></figure></p>
<p>逼格满满啊有木有？！我们可以定义一个属于自己的 sum 函数<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sum = initValue =&gt; foldr(x =&gt; accumulator =&gt; x + accumulator)(initValue);</span><br><span class="line"><span class="keyword">let</span> sumValue = sum(<span class="number">10</span>)([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]); <span class="comment">// 20</span></span><br></pre></td></tr></table></figure></p>
<p>一个属于自己的 sum 函数就这样诞生了，单参数，无变量，单语句，干脆利落。自己的函数库至此多了一个高逼格函数！（差不多就行，不能太不要脸了）</p>
<h3 id="map__u51FD_u6570"><a href="#map__u51FD_u6570" class="headerlink" title="map 函数"></a>map 函数</h3><p>我们再来看看熟悉的 <code>map</code> 函数<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> squareArray = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>].map(item =&gt; item * item); <span class="comment">// [1, 4, 9, 16]</span></span><br></pre></td></tr></table></figure></p>
<p>使用 <code>map</code> 函数已经相当优雅了，不过，既然我们已经有遍历函数了，那么我们能否用函数式编程实现 <code>map</code> 函数呢？<br><code>map</code> 函数返回的是一个处理后的数组，那么我们只需让累加器返回数组即可<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = f =&gt; foldr(x =&gt; accumulator =&gt; [f(x), ...accumulator])([]);</span><br></pre></td></tr></table></figure></p>
<p>相当于 <code>f(x)(accumulator)</code> 返回了一个数组 <code>[f(x), ...accumulator]</code>, 遍历结束后刚好就是 <code>map</code> 函数返回的结果，调用方式如下<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> squareArray = map(item =&gt; item * item)([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]); <span class="comment">// [1, 4, 9, 16]</span></span><br></pre></td></tr></table></figure></p>
<p>又一个函数入库了！</p>
<h3 id="u6B63_u5E8F_u904D_u5386"><a href="#u6B63_u5E8F_u904D_u5386" class="headerlink" title="正序遍历"></a>正序遍历</h3><p>倒序遍历我们已经玩腻了，那有没有正序遍历呢？<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> foldl = f =&gt; accumulator =&gt; ([x, ...xs]) =&gt;</span><br><span class="line">  x === <span class="literal">undefined</span> ? accumulator : foldl(f)(f(accumulator)(x))(xs);</span><br></pre></td></tr></table></figure></p>
<p>函数采用递归的方式，算到最后是这样的形式（以数组 [1, 2] 为例）<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f(f(a)(<span class="number">1</span>))(<span class="number">2</span>)</span><br></pre></td></tr></table></figure></p>
<p>不难看出，最终是将数组正序遍历，计算出 f(accumulator)(x) 的值, 并将结果作为新的 accumulator 传递下去，直到遍历完毕。</p>
<blockquote>
<p>因为是将数组正序遍历，所以我们将函数起名叫 <code>foldl</code>，与前面的 <code>foldr</code> 函数对应</p>
</blockquote>
<h3 id="loopOnArray__u51FD_u6570"><a href="#loopOnArray__u51FD_u6570" class="headerlink" title="loopOnArray 函数"></a>loopOnArray 函数</h3><p>正序遍历的一个典型用处就是循环。我们利用 <code>foldl</code> 循环打印数组的每一个值<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">foldl(item =&gt; <span class="built_in">console</span>.log(item))()([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br></pre></td></tr></table></figure></p>
<p>不难发现，我们是不需要累加的，即不需要存储 accumulator 这个状态，每一步操作都和 accumulator 无关，但还是需要传这个参数<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> loopOnArray = f =&gt; foldl(_ =&gt; x =&gt; f(x))(<span class="literal">undefined</span>);</span><br></pre></td></tr></table></figure></p>
<p>我们这里用 <code>_</code> 来代表空参数，因为这里不需要用到 accumulator, 用一个空参数来替代，调用范式如下<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loopOnArray(item =&gt; <span class="built_in">console</span>.log(item))([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])h</span><br></pre></td></tr></table></figure></p>
<p>一个函数也能实现循环了，亦可赛艇！</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/24/ES6学习笔记-集合/" itemprop="url">
                  ES6学习笔记-集合
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-01-24T16:06:52+08:00" content="2016-01-24">
              2016-01-24
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h2><blockquote>
<p>一个 Set 是一群值的集合，它是可变的，能够增删元素。</p>
</blockquote>
<h3 id="Set__u548C_Array__u7684_u533A_u522B"><a href="#Set__u548C_Array__u7684_u533A_u522B" class="headerlink" title="Set 和 Array 的区别"></a>Set 和 Array 的区别</h3><ul>
<li><p>一个 Set 不会包含相同元素，试图再次加入一个已有元素不会产生任何效果</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>(<span class="string">'1234'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(set.size);</span><br><span class="line"></span><br><span class="line">set.add(<span class="string">'1'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(set.size);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Set 的数据存储结构专门为 <code>包含性检测</code> 作了速度优化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arrayOfWords.indexOf(<span class="string">'word'</span>) !== -<span class="number">1</span>  <span class="comment">// 慢</span></span><br><span class="line">setOfWords.has(<span class="string">'word'</span>)               <span class="comment">// 快</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Set 不能提供索引</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arrayOfWords[<span class="number">15000</span>] <span class="comment">// 'word'</span></span><br><span class="line">setOfWords[<span class="number">15000</span>]   <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Set__u7684_u64CD_u4F5C"><a href="#Set__u7684_u64CD_u4F5C" class="headerlink" title="Set 的操作"></a>Set 的操作</h3><ul>
<li>new Set：创建一个新的、空的 Set</li>
<li>new Set(iterable)：从任何 <code>可遍历数据</code> 中提取元素，构造一个新的集合<br>你可以用它把数组转化为集合，在一行代码内去重；也可以传递一个生成器，函数会逐个遍历它，并把生成的值收录为一个集合；也可以用来复制一个已有的集合</li>
<li>set.size 获取集合中元素个数</li>
<li>set.has(value)：判定集合中是否含有指定元素，返回一个布尔值</li>
<li>set.add(value)：添加元素，如果与已有重复，则不产生效果</li>
<li>set.delete(value)：删除元素，如果并不存在，则不产生效果。<code>.add()</code> 和 <code>.delete()</code> 都会返回集合自身，所以我们可以用链式语法</li>
<li>set<a href="">Symbol.iterator</a>：返回一个新的遍历整个集合的迭代器。一般这个方法不会被直接调用，因为实际上就是它使集合能够被遍历，也就是说，我们可以直接写<code>for (v of set) {...}</code> 等等</li>
<li>set.forEach(f)：它就像是 <code>for (let value of set) { f(value, value, set); }</code> 的简写，类似于数组的 <code>.forEach()</code> 方法</li>
<li>set.clear()：清空集合</li>
<li>set.keys()、set.values()和set.entries()：返回各种迭代器<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将迭代器转化为数组输出</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Array</span>.from(set.keys()));    <span class="comment">// [ '1', '2', '3', '4' ]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Array</span>.from(set.values()));  <span class="comment">// [ '1', '2', '3', '4' ]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Array</span>.from(set.entries())); <span class="comment">// [ [ '1', '1' ], [ '2', '2' ], [ '3', '3' ], [ '4', '4' ] ]</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h2><blockquote>
<p>一个 Map 对象由若干键值对组成，类似 Java 的 Map 对象</p>
</blockquote>
<h3 id="Map__u7684_u64CD_u4F5C"><a href="#Map__u7684_u64CD_u4F5C" class="headerlink" title="Map 的操作"></a>Map 的操作</h3><ul>
<li>new Map：返回一个新的、空的 Map</li>
<li>new Map(pairs)：根据所含元素形如 <code>[key, value]</code> 的数组 pairs 来创建一个新的 Map。这里提供的 pairs 可以是一个已有的 Map  对象，可以是一个由二元数组组成的数组，也可以是逐个生成二元数组的一个生成器，等等。</li>
<li>map.size：返回 Map 中键值对的个数</li>
<li>map.has(key)：测试一个键名是否存在，类似 <code>key in obj</code></li>
<li>map.get(key)：返回一个键名对应的值，若键名不存在则返回 undefined，类似 <code>obj[key]</code></li>
<li>map.set(key, value)：添加一对新的键值对，如果键名已存在就覆盖</li>
<li>map.delete(key)：按键名删除一项，类似 <code>delete obj[key]</code></li>
<li>map.clear()：清空 Map</li>
<li>map<a href="">Symbol.iterator</a>：返回遍历所有项的迭代器，每项用一个键和值组成的二元数组表示</li>
<li>map.forEach(f)：类似 <code>for (let [key, value] of map) { f(value, key, map); }</code></li>
<li>map.keys()：返回遍历所有键的迭代器</li>
<li>map.values()：返回遍历所有值的迭代器</li>
<li>map.entries()：返回遍历所有项的迭代器，就像 <code>map[Symbol.iterator]()</code></li>
</ul>
<h3 id="WeakMap__u548C_WeakSet"><a href="#WeakMap__u548C_WeakSet" class="headerlink" title="WeakMap 和 WeakSet"></a>WeakMap 和 WeakSet</h3><p>WeakMap 和 WeakSet 被设计来完成与 Map、Set 几乎一样的行为，除了以下一些限制：</p>
<ul>
<li>WeakMap 只支持 new、has、get、set 和 delete</li>
<li>WeakSet 只支持 new、has、add 和 delete</li>
<li>WeakSet 的值和 WeakMap 的键必须是对象<blockquote>
<p>这些小心设计的限制让垃圾回收机制能回收仍在使用中的弱集合里的无效对象。这效果类似于弱引用或弱键字典，但ES6的弱集合可以在不暴露脚本中正在垃圾回收的前提下得到垃圾回收的效益</p>
</blockquote>
</li>
</ul>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/05/发布自己的node模块/" itemprop="url">
                  发布自己的node模块
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-01-05T16:57:21+08:00" content="2016-01-05">
              2016-01-05
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Node-js/" itemprop="url" rel="index">
                    <span itemprop="name">Node.js</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <blockquote>
<p>用了那么多的 node_modules，想不想发布自己的模块呢？</p>
</blockquote>
<h2 id="u5728_GitHub_uFF08_u6216_u8005_u5176_u4ED6_u6258_u7BA1_u5DE5_u5177_uFF09_u521B_u5EFA_u4E00_u4E2A_u9879_u76EE"><a href="#u5728_GitHub_uFF08_u6216_u8005_u5176_u4ED6_u6258_u7BA1_u5DE5_u5177_uFF09_u521B_u5EFA_u4E00_u4E2A_u9879_u76EE" class="headerlink" title="在 GitHub（或者其他托管工具）创建一个项目"></a>在 GitHub（或者其他托管工具）创建一个项目</h2><p>这可以方便用户报 bug，并且可以有其他开发者一起贡献代码。</p>
<h2 id="u521D_u59CB_u5316_package-json"><a href="#u521D_u59CB_u5316_package-json" class="headerlink" title="初始化 package.json"></a>初始化 package.json</h2><p>进入目录后，执行 <code>npm init</code>，根据提示完成初始化，以下是 package.json 文件的几点说明</p>
<ul>
<li><code>name</code>: 项目名称，发布的时候要保证在 npmjs 上的唯一性</li>
<li><p><code>version</code>: 版本号，有如下规则</p>
<blockquote>
<p>版本格式：主版号.次版号.修订号，版号递增规则如下：<br>  主版号：当你做了不相容的 API 修改，<br>  次版号：当你做了向下相容的功能性新增，<br>  修订号：当你做了向下相容的问题修正。<br>  先行版号及版本编译资讯可以加到「主版号.次版号.修订号」的后面，作为延伸。</p>
</blockquote>
</li>
<li><p><code>main</code>: 入口文件，一般为 <code>index.js</code></p>
</li>
<li><code>dependencies</code>: 项目依赖</li>
</ul>
<h2 id="u9879_u76EE_u7ED3_u6784"><a href="#u9879_u76EE_u7ED3_u6784" class="headerlink" title="项目结构"></a>项目结构</h2><ul>
<li><code>lib</code>: 存放业务逻辑温健</li>
<li><code>test</code>: 存放单元测试用例</li>
<li><code>.npmignore</code>: 记录哪些文件不需要被发布到 npmjs.org</li>
<li><code>index.js</code>: 入口文件</li>
<li><code>README.md</code>: 描述文件</li>
</ul>
<h2 id="u6301_u7EED_u96C6_u6210"><a href="#u6301_u7EED_u96C6_u6210" class="headerlink" title="持续集成"></a>持续集成</h2><blockquote>
<p>为保证模块的可用性，使用持续集成工具吧，在此不再赘述</p>
</blockquote>
<h2 id="u53D1_u5E03"><a href="#u53D1_u5E03" class="headerlink" title="发布"></a>发布</h2><ul>
<li>在 <code>www.npmjs.org</code> 注册一个账号</li>
<li>添加 npm 本地配置<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ npm adduser</span><br><span class="line"><span class="label">Username:</span> your name</span><br><span class="line"><span class="label">Password:</span> your password</span><br><span class="line"><span class="label">Email:</span> yourmail</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>成功之后，npm 认证信息会存放在 <code>~/.npmrc</code> 下，我们可以使用命令 <code>npm whoami</code> 查看当前用户</p>
<ul>
<li>发布<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">npm</span> publish</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>至此，你的模块就发布成功了。还等什么，一起为好用的模块做出贡献吧。</p>
</blockquote>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/03/ES6学习笔记-箭头函数-Arrow-Functions/" itemprop="url">
                  ES6学习笔记-箭头函数 Arrow Functions
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-01-03T10:48:10+08:00" content="2016-01-03">
              2016-01-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JavaScript/" itemprop="url" rel="index">
                    <span itemprop="name">JavaScript</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="u7BAD_u5934_u51FD_u6570_u7684_u8BED_u6CD5"><a href="#u7BAD_u5934_u51FD_u6570_u7684_u8BED_u6CD5" class="headerlink" title="箭头函数的语法"></a>箭头函数的语法</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES5</span></span><br><span class="line"><span class="keyword">var</span> selected = numbers.filter(<span class="function"><span class="keyword">function</span>(<span class="params">number</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> number.isSelected();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="keyword">let</span> selected = numbers.filter(number =&gt; number.isSelected());</span><br></pre></td></tr></table></figure>
<p>箭头函数的语法就是 <code>标示符 =&gt; 表达式</code>，无需输入 <code>function</code> <code>return</code> 等，省略了一些括号</p>
<ul>
<li><p>多个参数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES5</span></span><br><span class="line"><span class="keyword">var</span> sum = numbers.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="keyword">let</span> sum = number.reduce((a, b) =&gt; a + b, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>包含一个语句块</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES5</span></span><br><span class="line">$(<span class="string">'#button'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  prepare();</span><br><span class="line">  doSomeJob();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line">$(<span class="string">'#button'</span>).click(event =&gt; &#123;</span><br><span class="line">  prepare();  </span><br><span class="line">  doSomeJob();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>包含一个语句块的箭头函数不会自动返回值，若需要则手动添加 <code>return</code> 语句</p>
</blockquote>
<ul>
<li>用箭头函数创建普通对象需要小心<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// error</span></span><br><span class="line"><span class="keyword">let</span> newNumber = numbers.map(number =&gt; &#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// correct</span></span><br><span class="line"><span class="keyword">let</span> newNumber = numbers.map(number =&gt; (&#123;&#125;));</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>小窍门：所有对象字面量用小括号包裹以避免歧义</p>
</blockquote>
<h2 id="this__u503C"><a href="#this__u503C" class="headerlink" title="this 值"></a>this 值</h2><blockquote>
<p>箭头函数没有自己的 this 值，箭头函数内的 this 值继承自外作用域</p>
</blockquote>
<p>在 ES6 中需要遵循的规则</p>
<ul>
<li>通过 <code>object.method()</code> 语法调用的方法使用非箭头函数定义，这些函数需要从调用者的作用域中获取一个有意义的 this 值</li>
<li>其他情况全部使用箭头函数<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">  addAll: <span class="function"><span class="keyword">function</span> <span class="title">addAll</span>(<span class="params">pieces</span>) </span>&#123;</span><br><span class="line">    _.each(numbers, number =&gt; <span class="keyword">this</span>.add(number));</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>这里的 this 是 addAll 方法从它的调用者处获取的，内部函数是一个箭头函数，所以 this 不变<br>上面的代码还可以简化：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">  addAll(pieces) &#123;</span><br><span class="line">    _.each(numbers, number =&gt; <span class="keyword">this</span>.add(number));</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/12/29/使用-Jenkins-构建-nodejs-应用/" itemprop="url">
                  使用 Jenkins 构建 nodejs 应用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-12-29T21:31:53+08:00" content="2015-12-29">
              2015-12-29
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Node-js/" itemprop="url" rel="index">
                    <span itemprop="name">Node.js</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="u51C6_u5907_u5DE5_u4F5C"><a href="#u51C6_u5907_u5DE5_u4F5C" class="headerlink" title="准备工作"></a>准备工作</h2><ul>
<li><p>安装 Jenkins</p>
</li>
<li><p>安装如下插件，并重启 Jenkins</p>
<ul>
<li>GIT client plugin</li>
<li>GIT plugin</li>
<li>Git server plugin</li>
<li>SSH Credentials Plugin</li>
<li>SSH plugin</li>
<li>Publish Over SSH</li>
</ul>
</li>
<li><p>系统配置<br>进入 <code>系统管理</code> =&gt; <code>系统设置</code>，进行以下配置</p>
<ul>
<li>增加远程服务器的 remote server<br>每需要连接一个新的远程服务器，都需要在此配置服务器的连接属性。<ul>
<li>SSH remote hosts<br>配置 <code>Hostname</code>, <code>Port</code>, <code>User Name</code>, <code>Password</code></li>
<li>Publish over SSH<br>配置 SSH Servers，配置 <code>Name</code>, <code>Hostname</code>, <code>Username</code>, <code>Remote Directory</code><br>点击展开高级配置，勾选 <code>Use password authentication, or use a different key</code>，并配置 <code>Password</code><br>配置端口，默认为 <code>22</code>，配置 <code>Timeout</code>，此处因为 nodejs 构建时需要进行 <code>npm install</code> 操作，耗时可能受网络影响较大，故可以配置较高数值。</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="u6784_u5EFA_u9879_u76EE"><a href="#u6784_u5EFA_u9879_u76EE" class="headerlink" title="构建项目"></a>构建项目</h2><ul>
<li><p>点击新建按钮，选择<code>构建一个自由风格的软件项目</code></p>
</li>
<li><p>项目配置</p>
<ul>
<li>根据自己的需求配置项目的基本信息，如 <code>nodejs_deploy</code></li>
<li><p>源码管理<br>选择自己的代码管理系统，这里我们用<code>Git</code>，注意：如果是 public 的项目，则只需要填写 <code>Repository URL</code> 即可；如果是 private 的项目，则需要选择正确的 <code>Credentials</code>，Credentials 的配置方法如下：</p>
<ul>
<li>在 Jenkins 主页点击进入 Credentials</li>
<li>在 Domain 中选择，这里选 Global</li>
<li>添加 Credentials<ul>
<li>在 <code>${Jenkins主目录}/.ssh/</code> 目录下，生成公钥和私钥</li>
<li>复制公钥文件到当前目录下 <code>cp id_rsa.pub authorized_keys</code></li>
<li><code>Username</code> 填写你现在登录的用户名</li>
<li><code>Private Key</code> 选择 <code>Enter directly</code>，使用 <code>cat id_rsa</code> 获取私钥，并复制到 <code>Key</code> 中</li>
<li><code>Passphrase</code> 为你生成公钥和私钥时填写的密码</li>
<li><code>Description</code> 填写描述，方便在项目中选择</li>
</ul>
</li>
<li>在 Git 项目配置中(这里有可能是 Gitlab，总之就是你的项目主页)，将刚才生成的公钥添加到项目的 <code>Publish Keys</code> 列表中完成授权</li>
</ul>
<p>选择刚才创建的 Credentials，发现配置信息那里的错误消失了，说明连接源码库成功<br>最后，填写需要构建的分支，默认为 <code>*/master</code><br>到这一步，可以保存，然后点击 <code>立即构建</code>，测试项目能否成功拉取代码</p>
</li>
<li><p>构建步骤</p>
<ul>
<li>开始构建后，Jenkins 会先帮我们拉取代码</li>
<li>在项目配置中，可以添加构建步骤，分别对应如下<ul>
<li><code>Execute Windows batch command</code>: Windows 系统节点下地自动化批处理任务</li>
<li><code>Execute shell</code>: 在命令行中执行脚本</li>
<li><code>Execute shell script on remote host using ssh</code>: 使用 SSH 链接到远程服务器并执行脚本</li>
<li><code>Invoke Ant</code>: 整合 Apache Ant</li>
<li><code>Invoke top-level Maven targets</code>: Maven 构建指令</li>
<li><code>Send files or execute commands over SSH</code>: 使用 SSH 传送文件到服务器并执行脚本</li>
</ul>
</li>
<li><p>nodejs 项目的构建</p>
<ul>
<li><p>重新生成源码包，并使用当前构建号将源码包命名存储<br>新建 <code>Execute shell</code>，执行下面的命令(这里的命令有一些环境参数可用，具体可点击文本框下面的链接查看可用参数)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rm -rf <span class="variable">$&#123;WORKSPACE&#125;</span>/<span class="variable">$&#123;JOB_NAME&#125;</span>.tar.gz</span><br><span class="line">tar -zcvf /tmp/<span class="variable">$&#123;JOB_NAME&#125;</span>.tar.gz -C <span class="variable">$&#123;WORKSPACE&#125;</span>/ .</span><br><span class="line">mv /tmp/<span class="variable">$&#123;JOB_NAME&#125;</span>.tar.gz <span class="variable">$&#123;WORKSPACE&#125;</span>/</span><br><span class="line">cp <span class="variable">$&#123;WORKSPACE&#125;</span>/<span class="variable">$&#123;JOB_NAME&#125;</span>.tar.gz <span class="variable">$&#123;JENKINS_HOME&#125;</span>/<span class="built_in">jobs</span>/<span class="variable">$&#123;JOB_NAME&#125;</span>/builds/<span class="variable">$&#123;BUILD_NUMBER&#125;</span>.tar.gz</span><br></pre></td></tr></table></figure>
<p>这样，就将原有源码包删除，生成最新源码包，并存放到当前项目目录下的 <code>builds</code> 文件夹中</p>
</li>
<li><p>到服务器停止原来的进程，并删除原来的源码包<br>新建 <code>Execute shell script on remote host using ssh</code>，执行下面的命令</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">forever stop nodejs/app<span class="class">.js</span></span><br><span class="line">rm -rf nodejs/nodejs_deploy<span class="class">.tar</span><span class="class">.gz</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>将最新源码包发送到服务端，解压，然后执行 nodejs 基本的构建步骤<br>新建 <code>Send files or execute commands over SSH</code><br><code>Source files</code> 填写 <code>nodejs.tar.gz</code><br><code>Remote directory</code> 填写 <code>nodejs</code><br>执行下面的命令</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf ~/nodejs/nodejs_deploy.tar.gz -C ~/nodejs/</span><br><span class="line">cd nodejs</span><br><span class="line">npm install</span><br><span class="line">bower install</span><br><span class="line"><span class="keyword">node</span><span class="identifier"> </span><span class="title">--harmony</span> `which gulp`</span><br><span class="line">forever <span class="literal">start</span> -c <span class="string">"node --harmony"</span> app.js</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>至此，nodejs 项目构建完毕并启动(上述所有的构建过程都可以根据自己的项目需要进行配置)</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="u56DE_u6EDA_u9879_u76EE"><a href="#u56DE_u6EDA_u9879_u76EE" class="headerlink" title="回滚项目"></a>回滚项目</h2><blockquote>
<p>我们使用构建一个项目的方式，来实现原有项目的回滚</p>
</blockquote>
<ul>
<li><p>点击新建按钮，选择<code>构建一个自由风格的软件项目</code></p>
</li>
<li><p>项目配置</p>
<ul>
<li><p>根据自己的需求配置项目的基本信息，如 <code>nodejs_revert</code></p>
</li>
<li><p>配置回滚构建号<br>勾选 <code>参数化构建过程</code>，添加参数 <code>String Parameter</code>，并起个名字，这里叫 <code>VERSION</code></p>
</li>
<li><p>构建步骤</p>
<ul>
<li><p>拷贝该构建号的源码包到此项目的 <code>WORKSPACE</code> 下<br>新建 <code>Execute shell</code>，执行下面的命令(这里的命令有一些环境参数可用，具体可点击文本框下面的链接查看可用参数)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -rf <span class="variable">$&#123;JENKINS_HOME&#125;</span>/<span class="built_in">jobs</span>/nodejs_deploy/builds/<span class="variable">$&#123;VERSION&#125;</span>.tar.gz <span class="variable">$&#123;WORKSPACE&#125;</span>/.</span><br></pre></td></tr></table></figure>
</li>
<li><p>到服务器停止原来的进程，并删除原来的源码包<br>新建 <code>Execute shell script on remote host using ssh</code>，执行下面的命令</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">forever stop nodejs/app<span class="class">.js</span></span><br><span class="line">rm -rf nodejs/nodejs_deploy<span class="class">.tar</span><span class="class">.gz</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>将最新源码包发送到服务端，解压，然后执行 nodejs 基本的构建步骤<br>新建 <code>Send files or execute commands over SSH</code><br><code>Source files</code> 填写 <code>${VERSION}.tar.gz</code><br><code>Remote directory</code> 填写 <code>nodejs</code><br>执行下面的命令</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mv -f ~/nodejs/$&#123;<span class="operator">VERSION</span>&#125;.tar.gz ~/nodejs/nodejs_deploy.tar.gz</span><br><span class="line">tar -zxvf ~/nodejs/nodejs_deploy.tar.gz -C ~/nodejs/</span><br><span class="line">cd nodejs</span><br><span class="line">npm install</span><br><span class="line">bower install</span><br><span class="line"><span class="keyword">node</span><span class="identifier"> </span><span class="title">--harmony</span> `which gulp`</span><br><span class="line">forever <span class="literal">start</span> -c <span class="string">"node --harmony"</span> app.js</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>配置完成后，项目的构建按钮变成了 <code>Build with Parameters</code>，点击后输入参数即可进行构建版本的回滚</p>
</li>
</ul>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/12/15/ubuntu14-04-安装-Node-js-LTS-V4-2-3/" itemprop="url">
                  ubuntu14.04 安装 Node.js LTS V4.2.3
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-12-15T15:26:27+08:00" content="2015-12-15">
              2015-12-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Node-js/" itemprop="url" rel="index">
                    <span itemprop="name">Node.js</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <blockquote>
<p>因项目需要，经常在服务器上部署 Node.js，记录一下操作，以便查阅。<br>这里使用源码包编译的方法安装 Node.js</p>
</blockquote>
<ol>
<li><p>到官网 <a href="https://nodejs.org/en/download/" target="_blank" rel="external">https://nodejs.org/en/download/</a> 下载源码包 <code>node-v4.2.3.tar.gz</code></p>
</li>
<li><p>将源码包上传至服务器，若是在服务器直接下载源码包的，请直接跳过此步骤。这里用 scp 上传</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp ~/Downloads/<span class="keyword">node</span><span class="identifier"></span><span class="title">-v4</span>.<span class="number">2.3</span>.tar.gz username@hostname:~</span><br></pre></td></tr></table></figure>
</li>
<li><p>解压源码包</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xzvf <span class="keyword">node</span><span class="identifier"></span><span class="title">-v4</span>.<span class="number">2.3</span>.tar.gz</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装依赖的库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get <span class="operator"><span class="keyword">install</span> gcc  //gcc <span class="number">4.8</span>+</span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> <span class="keyword">g</span>++  //<span class="keyword">g</span>++ <span class="number">4.8</span>+</span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> clang  //clang <span class="number">3.4</span>+</span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> make   //GNU Make <span class="number">3.81</span>+</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>执行安装</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd <span class="keyword">node</span><span class="identifier"></span><span class="title">-v4</span>.<span class="number">2.3</span></span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试是否安装完成</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">node</span><span class="identifier"> </span><span class="title">-v</span></span><br><span class="line"><span class="keyword">node</span><span class="identifier"> </span><span class="title">-e</span> <span class="string">"console.log('Hello from Node.js ' + process.version)"</span></span><br></pre></td></tr></table></figure>
</li>
</ol>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/12/13/ES6学习笔记-解构-Destructuring/" itemprop="url">
                  ES6学习笔记-解构-Destructuring
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2015-12-13T13:01:16+08:00" content="2015-12-13">
              2015-12-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JavaScript/" itemprop="url" rel="index">
                    <span itemprop="name">JavaScript</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="u4EC0_u4E48_u662F_u89E3_u6784"><a href="#u4EC0_u4E48_u662F_u89E3_u6784" class="headerlink" title="什么是解构"></a>什么是解构</h2><p>我们以访问数组中的前三个元素为例</p>
<h3 id="u4F20_u7EDF_u7684_u8BBF_u95EE_u65B9_u5F0F"><a href="#u4F20_u7EDF_u7684_u8BBF_u95EE_u65B9_u5F0F" class="headerlink" title="传统的访问方式"></a>传统的访问方式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> frist = array[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">let</span> second = array[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">let</span> third = array[<span class="number">2</span>];</span><br></pre></td></tr></table></figure>
<h3 id="u4F7F_u7528_u89E3_u6784_u7684_u7279_u6027"><a href="#u4F7F_u7528_u89E3_u6784_u7684_u7279_u6027" class="headerlink" title="使用解构的特性"></a>使用解构的特性</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [first, second, third] = array;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>两段代码是完全等效的，利用新特性能使代码更加简洁和易读</p>
</blockquote>
<h2 id="u6570_u7EC4_u4E0E_u8FED_u4EE3_u5668_u7684_u89E3_u6784"><a href="#u6570_u7EC4_u4E0E_u8FED_u4EE3_u5668_u7684_u89E3_u6784" class="headerlink" title="数组与迭代器的解构"></a>数组与迭代器的解构</h2><h3 id="u4E00_u822C_u5F62_u5F0F"><a href="#u4E00_u822C_u5F62_u5F0F" class="headerlink" title="一般形式"></a>一般形式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [variable1, variable2, ..., variableN] = array;</span><br></pre></td></tr></table></figure>
<h3 id="u5D4C_u5957_u6570_u7EC4_u7684_u89E3_u6784"><a href="#u5D4C_u5957_u6570_u7EC4_u7684_u89E3_u6784" class="headerlink" title="嵌套数组的解构"></a>嵌套数组的解构</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [a, [[b], c]] = [<span class="number">1</span>, [[<span class="number">2</span>], <span class="number">3</span>]];</span><br><span class="line"><span class="built_in">console</span>.log(a);   <span class="comment">//1</span></span><br><span class="line"><span class="built_in">console</span>.log(b);   <span class="comment">//2</span></span><br><span class="line"><span class="built_in">console</span>.log(c);   <span class="comment">//3</span></span><br></pre></td></tr></table></figure>
<h3 id="u7559_u7A7A_u8DF3_u8FC7_u5143_u7D20"><a href="#u7559_u7A7A_u8DF3_u8FC7_u5143_u7D20" class="headerlink" title="留空跳过元素"></a>留空跳过元素</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [,,c] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="built_in">console</span>.log(c);   <span class="comment">//3</span></span><br></pre></td></tr></table></figure>
<h3 id="u7ED3_u5408_u4E0D_u5B9A_u53C2_u6570"><a href="#u7ED3_u5408_u4E0D_u5B9A_u53C2_u6570" class="headerlink" title="结合不定参数"></a>结合不定参数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [head, ...tail] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"><span class="built_in">console</span>.log(tail);    <span class="comment">//[2, 3, 4]</span></span><br></pre></td></tr></table></figure>
<h3 id="u8D8A_u754C_u65F6_u7684_u7ED3_u679C"><a href="#u8D8A_u754C_u65F6_u7684_u7ED3_u679C" class="headerlink" title="越界时的结果"></a>越界时的结果</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [missing] = [];</span><br><span class="line"><span class="built_in">console</span>.log(missing);   <span class="comment">//undefined</span></span><br></pre></td></tr></table></figure>
<h3 id="u5728_u8FED_u4EE3_u5668_u4E2D_u7684_u4F7F_u7528"><a href="#u5728_u8FED_u4EE3_u5668_u4E2D_u7684_u4F7F_u7528" class="headerlink" title="在迭代器中的使用"></a>在迭代器中的使用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">fibs</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> b = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">yield</span> a;</span><br><span class="line">    [a, b] = [b, a + b];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> [first, second, third, forth, fifth, sixth] = fibs();</span><br><span class="line"><span class="built_in">console</span>.log(sixth);   <span class="comment">//5</span></span><br></pre></td></tr></table></figure>
<h2 id="u5BF9_u8C61_u7684_u89E3_u6784"><a href="#u5BF9_u8C61_u7684_u89E3_u6784" class="headerlink" title="对象的解构"></a>对象的解构</h2><h3 id="u4E00_u822C_u5F62_u5F0F-1"><a href="#u4E00_u822C_u5F62_u5F0F-1" class="headerlink" title="一般形式"></a>一般形式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; name: nameA &#125; = &#123; name: <span class="string">'Lily'</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> &#123; name: nameB &#125; = &#123; name: <span class="string">'Lucy'</span> &#125;;</span><br><span class="line"><span class="built_in">console</span>.log(nameA);   <span class="comment">//Lily</span></span><br><span class="line"><span class="built_in">console</span>.log(nameB);   <span class="comment">//Lucy</span></span><br></pre></td></tr></table></figure>
<h3 id="u5C5E_u6027_u540D_u4E0E_u53D8_u91CF_u540D_u4E00_u81F4_u65F6_u7684_u7B80_u5199"><a href="#u5C5E_u6027_u540D_u4E0E_u53D8_u91CF_u540D_u4E00_u81F4_u65F6_u7684_u7B80_u5199" class="headerlink" title="属性名与变量名一致时的简写"></a>属性名与变量名一致时的简写</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; foo, bar &#125; = &#123; foo: <span class="string">'foo'</span>, bar: <span class="string">'bar'</span> &#125;</span><br><span class="line"><span class="built_in">console</span>.log(foo);   <span class="comment">//'foo'</span></span><br><span class="line"><span class="built_in">console</span>.log(bar);   <span class="comment">//'bar'</span></span><br></pre></td></tr></table></figure>
<h3 id="u5D4C_u5957_u5BF9_u8C61_u89E3_u6784"><a href="#u5D4C_u5957_u5BF9_u8C61_u89E3_u6784" class="headerlink" title="嵌套对象解构"></a>嵌套对象解构</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> complicatedObj = &#123;</span><br><span class="line">  arrayProp: [</span><br><span class="line">    <span class="string">'Zapp'</span>,</span><br><span class="line">    &#123; second: <span class="string">'Brannigan'</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> &#123;</span><br><span class="line">  arrayProp: [</span><br><span class="line">    first,</span><br><span class="line">    &#123; second &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125; = complicatedObj;</span><br><span class="line"><span class="built_in">console</span>.log(first);   <span class="comment">//'Zapp'</span></span><br><span class="line"><span class="built_in">console</span>.log(second);   <span class="comment">//'Brannigan'</span></span><br></pre></td></tr></table></figure>
<h3 id="u89E3_u6784_u672A_u5B9A_u4E49_u7684_u5C5E_u6027"><a href="#u89E3_u6784_u672A_u5B9A_u4E49_u7684_u5C5E_u6027" class="headerlink" title="解构未定义的属性"></a>解构未定义的属性</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; missing &#125; = &#123;&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(missing);   <span class="comment">//undefined</span></span><br></pre></td></tr></table></figure>
<h3 id="u82E5_u53D8_u91CF_u5DF2_u5B9A_u4E49_u597D_uFF0C_u89E3_u6784_u8BED_u53E5_u4E2D_u4E0D_u5B58_u5728_let__u7B49_u5173_u952E_u5B57"><a href="#u82E5_u53D8_u91CF_u5DF2_u5B9A_u4E49_u597D_uFF0C_u89E3_u6784_u8BED_u53E5_u4E2D_u4E0D_u5B58_u5728_let__u7B49_u5173_u952E_u5B57" class="headerlink" title="若变量已定义好，解构语句中不存在 let 等关键字"></a>若变量已定义好，解构语句中不存在 let 等关键字</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123; a &#125; = &#123; a: <span class="number">10</span> &#125;;    <span class="comment">//Syntax error 语法错误</span></span><br><span class="line">()&#123; a &#125; = &#123; a: <span class="number">10</span> &#125;);   <span class="comment">//无语法错误</span></span><br></pre></td></tr></table></figure>
<h2 id="u89E3_u6784_u503C_u4E0D_u662F_u5BF9_u8C61_u3001_u6570_u7EC4_u6216_u8FED_u4EE3_u5668"><a href="#u89E3_u6784_u503C_u4E0D_u662F_u5BF9_u8C61_u3001_u6570_u7EC4_u6216_u8FED_u4EE3_u5668" class="headerlink" title="解构值不是对象、数组或迭代器"></a>解构值不是对象、数组或迭代器</h2><p>尝试解构 undefined 或者 null 时，会得到类型错误<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; blowUp &#125; = <span class="literal">null</span>;  <span class="comment">//TypeError: null has no properties</span></span><br></pre></td></tr></table></figure></p>
<p>然而，解构其他原始类型就不会报错，但是会得到 undefined<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> &#123; wtf &#125; = <span class="literal">NaN</span>;</span><br><span class="line"><span class="built_in">console</span>.log(wtf);   <span class="comment">//undefined</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>原因：当使用对象赋值模式时，被解构的值会被强制转换为对象，null 和 undefined 无法进行转换所以出现错误。</p>
</blockquote>
<h2 id="u9ED8_u8BA4_u503C"><a href="#u9ED8_u8BA4_u503C" class="headerlink" title="默认值"></a>默认值</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [missing = <span class="literal">true</span>] = [];</span><br><span class="line"><span class="built_in">console</span>.log(missing);   <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<h2 id="u5B9E_u9645_u5E94_u7528"><a href="#u5B9E_u9645_u5E94_u7528" class="headerlink" title="实际应用"></a>实际应用</h2><h3 id="u51FD_u6570_u53C2_u6570_u5B9A_u4E49"><a href="#u51FD_u6570_u53C2_u6570_u5B9A_u4E49" class="headerlink" title="函数参数定义"></a>函数参数定义</h3><blockquote>
<p>作为开发者，我们需要实现设计良好的API，通常的做法是为函数为函数设计一个对象作为参数，然后将不同的实际参数作为对象属性，以避免让API使用者记住 多个参数的使用顺序。我们可以使用解构特性来避免这种问题，当我们想要引用它的其中一个属性时，大可不必反复使用这种单一参数对象。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">removeBreakpoint</span>(<span class="params">&#123; url, line, column &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u914D_u7F6E_u5BF9_u8C61_u53C2_u6570"><a href="#u914D_u7F6E_u5BF9_u8C61_u53C2_u6570" class="headerlink" title="配置对象参数"></a>配置对象参数</h3><blockquote>
<p>当我们构造一个提供配置的对象，并且需要这个对象的属性携带默认值时，解构特性就派上用场了。举个例子，jQuery的ajax函数使用一个配置对象作为它的第二参数，我们可以这样重写函数定义：</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">jQuery.ajax = <span class="function"><span class="keyword">function</span> (<span class="params">url, &#123;</span><br><span class="line">  async = true,</span><br><span class="line">  beforeSend = noop,</span><br><span class="line">  cache = true,</span><br><span class="line">  complete = noop,</span><br><span class="line">  crossDomain = false,</span><br><span class="line">  global = true,</span><br><span class="line">  <span class="comment">// ... 更多配置</span></span><br><span class="line">&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ... do stuff</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如此一来，我们可以避免对配置对象的每个属性都重复var foo = config.foo || theDefaultFoo;这样的操作。</p>
</blockquote>
<h3 id="u4E0E_u8FED_u4EE3_u5668_u534F_u540C_u4F7F_u7528"><a href="#u4E0E_u8FED_u4EE3_u5668_u534F_u540C_u4F7F_u7528" class="headerlink" title="与迭代器协同使用"></a>与迭代器协同使用</h3><p>在迭代 Maps 时，可以得到一些列形如[key, value]的键值对，此时利用解构可以更轻松地访问键和值<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">map.set(<span class="built_in">window</span>, <span class="string">'the global'</span>);</span><br><span class="line">map.set(<span class="built_in">document</span>, <span class="string">'the document'</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> map) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;key&#125;</span> is <span class="subst">$&#123;valuel&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>只遍历键<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [key] <span class="keyword">of</span> map) &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>或只遍历值<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [, value] <span class="keyword">of</span> map) &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="u591A_u91CD_u8FD4_u56DE_u503C"><a href="#u591A_u91CD_u8FD4_u56DE_u503C" class="headerlink" title="多重返回值"></a>多重返回值</h3><ul>
<li><p>返回一个数组将结果解构</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">returnMultipleValues</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [<span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> [first, second] = returnMultipleValues();</span><br></pre></td></tr></table></figure>
</li>
<li><p>用一个对象作为容器并为返回值命名</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">returnMultipleValues</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    first: <span class="number">1</span>,</span><br><span class="line">    second: <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> &#123; first, second &#125; = returnMultipleValues();</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="u5BFC_u5165_u6A21_u5757"><a href="#u5BFC_u5165_u6A21_u5757" class="headerlink" title="导入模块"></a>导入模块</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; SourceMapConsumer, SourceNode &#125; = <span class="built_in">require</span>(<span class="string">"source-map"</span>);</span><br></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/author.png" alt="Splendour" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Splendour</p>
        </div>
        <p class="site-description motion-element" itemprop="description"></p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">20</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">7</span>
              <span class="site-state-item-name">分类</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">标签</span>
              
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/splendourhui" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Splendour</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    
    

  


  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
